'use strict';

function LoadFromDb() {
    $.ajax({
        type: 'POST',
        contentType: "application/json",
        url: '/get/companies',
        success: function success(data) {
            for (var i = 0; i < data.length; ++i) {
                CreateCompany(data.id, data.name, data.price, data.parentId);
            }
        }
    });
}
window.onload = LoadFromDb;

var DeleteCompany = function DeleteCompany(id) {
    $.ajax({
        url: "/delete/company",
        type: "GET",
        data: JSON.stringify({ 'id': id }),
        contentType: "application/json",
        success: function success() {
            var deleteCompany = document.getElementById(id);
            inputForm.parentNode.removeChild(deleteCompany);
        }
    });
};

var DeleteAll = function DeleteAll() {
    $.ajax({
        url: "/delete/companies",
        type: "GET",
        success: function success(lastId) {
            for (var i = 0; i < lastId; ++i) {
                var deleteCompany = document.getElementById(i);
                if (deleteCompany != null) inputForm.parentNode.removeChild(deleteCompany);
            }
        }
    });
};

var AddCompany = function AddCompany(id, addOrEdit) {
    var companyName = document.getElementById("name").value;
    var price = document.getElementById("price").value;
    if (companyName == null || price == null) return;

    DeleteInputForm();
    var url = addOrEdit === undefined ? '/add/company' : '/edit/company';

    $.ajax({
        type: 'POST',
        contentType: 'application/json',
        url: url,
        data: JSON.stringify({ 'parentId': id, 'name': companyName, 'companyPrice': price }),
        success: function (data, status) {
            var temp = data.id;
            //alert(status + " " + data);

            CreateCompany(data.id, companyName, price, id);
        }
    });
};

var DeleteInputForm = function DeleteInputForm() {
    var inputForm = document.getElementById("ImputForm");
    inputForm.parentNode.removeChild(inputForm);;
};

var CreateInputForm = function CreateInputForm(id, addOrEdit) {
    var inputForm = document.getElementById("ImputForm");
    if (inputForm != null) return;

    var element = document.createElement('form');
    element.setAttribute("id", "ImputForm");
    element.setAttribute("class", "form-inline");
    element.setAttribute("role", 'form');

    if (id == -1) {
        var mainDiv = document.getElementById("AddCompanyDiv");
        mainDiv.appendChild(element);
    } else {
        var mainCompany = document.getElementById("nodes-" + id);
        mainCompany.appendChild(element);
    }

    var div = document.createElement('div');
    div.setAttribute("class", "form-group");
    element.appendChild(div);

    var node1 = document.createElement('label');
    node1.setAttribute("for", "name");
    node1.innerHTML = "Company name";
    div.appendChild(node1);

    var node2 = document.createElement('input');
    node2.setAttribute("id", "name");
    node2.setAttribute("type", "text");
    node2.setAttribute("class", "form-control");
    node2.setAttribute("placeholder", "name");
    div.appendChild(node2);

    var node3 = document.createElement('label');
    node3.setAttribute("for", "price");
    node3.innerHTML = "Prize";
    div.appendChild(node3);

    var node4 = document.createElement('input');
    node4.setAttribute("id", "price");
    node4.setAttribute("type", "text");
    node4.setAttribute("class", "form-control");
    node4.setAttribute("placeholder", "money");
    div.appendChild(node4);

    var node5 = document.createElement('input');
    node5.setAttribute("value", "Submit");
    node5.setAttribute("type", "submit");
    node5.setAttribute("id", id);
    node5.setAttribute("class", "btn btn-success");
    var nodeOnclickAttribute = addOrEdit === undefined ? "this.id" : "this.id, \"edit\"";
    node5.setAttribute("onclick", "AddCompany(" + nodeOnclickAttribute + ")");
    div.appendChild(node5);

    var node6 = document.createElement('input');
    node6.setAttribute("value", "Cancel");
    node6.setAttribute("type", "cancel");
    node6.setAttribute("class", "btn btn-danger");
    node6.setAttribute("onclick", "DeleteInputForm()");
    div.appendChild(node6);
};

var CreateCompany = function CreateCompany(id, name, price, parentId) {
    var element = document.createElement('div');
    element.setAttribute("id", id);
    element.setAttribute("class", "company");

    if (parentId == -1) {
        var mainDiv = document.getElementById("AddCompanyDiv");
        mainDiv.appendChild(element);
    } else {
        var parentCompany = document.getElementById("nodes-" + id);
        parentCompany.appendChild(element);
    }

    var span1 = document.createElement('span');
    span1.setAttribute("class", "companyText");
    element.appendChild(span1);

    var b = document.createElement('b');
    span1.appendChild(b);

    var a1 = document.createElement('a');
    a1.setAttribute("id", id);
    a1.setAttribute("class", "name");
    a1.innerHTML = name;
    b.appendChild(a1);

    var a2 = document.createElement('a');
    a2.setAttribute("id", id);
    a2.setAttribute("class", "price");
    a2.innerHTML = price;
    b.appendChild(a2);

    var a3 = document.createElement('a');
    a3.setAttribute("id", id);
    a3.setAttribute("class", "name");
    a3.innerHTML = "Allprice";
    b.appendChild(a3);

    var span2 = document.createElement('span');
    span2.setAttribute("class", "companyButtons");
    element.appendChild(span2);

    var divWithNodes = document.createElement('div');
    divWithNodes.setAttribute("class", "nodes");
    divWithNodes.setAttribute("id", "nodes-" + id);
    element.appendChild(divWithNodes);

    var button1 = document.createElement('button');
    button1.setAttribute("type", "button");
    button1.setAttribute("id", id);
    button1.setAttribute("class", "btn btn-default btn-xs");
    button1.setAttribute("aria-label", "Right Align");
    button1.setAttribute("onclick", "CreateInputForm(this.id, \"edit\")");
    span2.appendChild(button1);
    var glyphicon1 = document.createElement('span');
    glyphicon1.setAttribute("class", "glyphicon glyphicon-pencil");
    glyphicon1.setAttribute("aria-hidden", "true");
    button1.appendChild(glyphicon1);

    var button2 = document.createElement('button');
    button2.setAttribute("type", "button");
    button2.setAttribute("id", id);
    button2.setAttribute("class", "btn btn-default btn-xs");
    button2.setAttribute("onclick", "CreateInputForm(this.id)");
    span2.appendChild(button2);
    var glyphicon2 = document.createElement('span');
    glyphicon2.setAttribute("class", "glyphicon glyphicon-plus");
    glyphicon2.setAttribute("aria-hidden", "true");
    button2.appendChild(glyphicon2);

    var button3 = document.createElement('button');
    button3.setAttribute("type", "button");
    button3.setAttribute("id", id);
    button3.setAttribute("class", "btn btn-default btn-xs");
    button3.setAttribute("onclick", "DeleteCompany(this.id)");
    span2.appendChild(button3);
    var glyphicon3 = document.createElement('span');
    glyphicon3.setAttribute("class", "lyphicon glyphicon-minus");
    glyphicon3.setAttribute("aria-hidden", "true");
    button3.appendChild(glyphicon3);
};